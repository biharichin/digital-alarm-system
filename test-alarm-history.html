<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alarm History Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .alarm-demo {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #667eea;
        }
        .alarm-demo h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .alarm-demo pre {
            background: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîî Alarm History & Persistence Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Alarm Data Structure</h2>
        <p>Verify the new alarm data structure with history tracking.</p>
        
        <div class="alarm-demo">
            <h4>New Alarm Structure:</h4>
            <pre>{
  "id": "1703123456789",
  "time": "08:30",
  "label": "Wake Up",
  "enabled": true,
  "status": "pending", // pending, triggered, snoozed, completed
  "createdAt": "2023-12-21T08:30:00.000Z",
  "triggeredAt": null,
  "completedAt": null,
  "snoozeCount": 0,
  "lastSnoozeAt": null
}</pre>
        </div>
        
        <button onclick="testAlarmStructure()">Test Alarm Structure</button>
        <div id="structureResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Backend Alarm Persistence</h2>
        <p>Test saving and loading alarms from the backend database.</p>
        
        <button onclick="testBackendPersistence()">Test Backend Persistence</button>
        <div id="persistenceResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Alarm History Display</h2>
        <p>Test the new alarm history sections and status indicators.</p>
        
        <button onclick="openDashboard()">Open Dashboard</button>
        <button onclick="testAlarmHistory()">Test History Display</button>
        <div id="historyResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Complete User Flow</h2>
        <p>Test the complete user journey with alarm history.</p>
        
        <button onclick="openWelcomePage()">Start Complete Flow</button>
        <button onclick="openCountryCheck()">Country Check</button>
        <button onclick="openSignupForm()">Direct Signup</button>
        <div id="flowResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 5: Alarm Status Tracking</h2>
        <p>Test alarm status changes and history tracking.</p>
        
        <div class="alarm-demo">
            <h4>Status Flow:</h4>
            <pre>pending ‚Üí triggered ‚Üí snoozed ‚Üí pending ‚Üí triggered ‚Üí completed</pre>
        </div>
        
        <button onclick="testStatusTracking()">Test Status Tracking</button>
        <div id="statusResult"></div>
    </div>

    <script>
        // Test 1: Alarm Structure
        function testAlarmStructure() {
            const resultDiv = document.getElementById('structureResult');
            
            const testAlarm = {
                id: Date.now().toString(),
                time: "08:30",
                label: "Test Alarm",
                enabled: true,
                status: "pending",
                createdAt: new Date().toISOString(),
                triggeredAt: null,
                completedAt: null,
                snoozeCount: 0,
                lastSnoozeAt: null
            };
            
            const isValid = testAlarm.id && testAlarm.status && testAlarm.createdAt;
            
            if (isValid) {
                resultDiv.innerHTML = '<div class="test-result success">‚úÖ Alarm structure is valid</div>';
            } else {
                resultDiv.innerHTML = '<div class="test-result error">‚ùå Alarm structure is invalid</div>';
            }
        }

        // Test 2: Backend Persistence
        async function testBackendPersistence() {
            const resultDiv = document.getElementById('persistenceResult');
            resultDiv.innerHTML = '<div class="test-result info">üîÑ Testing backend persistence...</div>';
            
            try {
                // Test if backend is running
                const response = await fetch('http://localhost:3001/api/health');
                const result = await response.json();
                
                if (result.success) {
                    resultDiv.innerHTML = '<div class="test-result success">‚úÖ Backend is running and ready for alarm persistence</div>';
                } else {
                    resultDiv.innerHTML = '<div class="test-result error">‚ùå Backend health check failed</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="test-result error">‚ùå Backend connection failed: ' + error.message + '</div>';
            }
        }

        // Test 3: Alarm History Display
        function testAlarmHistory() {
            const resultDiv = document.getElementById('historyResult');
            
            // Simulate alarm history sections
            const sections = [
                { title: 'Active Alarms', icon: 'fas fa-clock', count: 2 },
                { title: 'Triggered Alarms', icon: 'fas fa-bell', count: 1 },
                { title: 'Alarm History', icon: 'fas fa-history', count: 5 }
            ];
            
            let html = '<div class="test-result success">‚úÖ Alarm history sections:</div>';
            sections.forEach(section => {
                html += `<div style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                    <strong>${section.title}</strong> (${section.count} alarms)
                </div>`;
            });
            
            resultDiv.innerHTML = html;
        }

        // Test 4: Complete User Flow
        function openWelcomePage() {
            window.open('alarm-system/welcome.html', '_blank');
        }

        function openCountryCheck() {
            window.open('alarm-system/country-check.html', '_blank');
        }

        function openSignupForm() {
            window.open('alarm-system/index.html', '_blank');
        }

        // Test 5: Status Tracking
        function testStatusTracking() {
            const resultDiv = document.getElementById('statusResult');
            
            const statusFlow = [
                { status: 'pending', description: 'Alarm created and waiting' },
                { status: 'triggered', description: 'Alarm time reached, playing sound' },
                { status: 'snoozed', description: 'User snoozed alarm' },
                { status: 'pending', description: 'Snooze alarm created' },
                { status: 'triggered', description: 'Snooze alarm triggered' },
                { status: 'completed', description: 'User stopped alarm' }
            ];
            
            let html = '<div class="test-result success">‚úÖ Alarm status flow:</div>';
            statusFlow.forEach((step, index) => {
                html += `<div style="margin: 5px 0; padding: 8px; background: #e9ecef; border-radius: 3px;">
                    ${index + 1}. <strong>${step.status}</strong> - ${step.description}
                </div>`;
            });
            
            resultDiv.innerHTML = html;
        }

        // Open Dashboard
        function openDashboard() {
            window.open('alarm-system/dashboard.html', '_blank');
        }

        // Auto-run some tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            testAlarmStructure();
            testBackendPersistence();
            testAlarmHistory();
            testStatusTracking();
        });
    </script>
</body>
</html> 