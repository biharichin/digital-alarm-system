<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Country Restriction Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input, select {
            padding: 8px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üåç Country Restriction Test</h1>
    
    <div class="test-section">
        <h2>Test 1: Frontend Validation</h2>
        <p>Test the frontend validation that prevents non-Indian users from submitting the form.</p>
        
        <form id="testForm">
            <input type="text" id="testName" placeholder="Name" value="Test User">
            <input type="email" id="testEmail" placeholder="Email" value="test@example.com">
            <input type="password" id="testPassword" placeholder="Password" value="password123">
            <input type="number" id="testAge" placeholder="Age" value="25">
            <select id="testCountry">
                <option value="">Select Country</option>
                <option value="India">India</option>
                <option value="United States">United States</option>
                <option value="United Kingdom">United Kingdom</option>
                <option value="Canada">Canada</option>
            </select>
            <button type="submit">Test Validation</button>
        </form>
        
        <div id="frontendResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Backend API Test</h2>
        <p>Test the backend API to ensure it rejects non-Indian users.</p>
        
        <button onclick="testBackendAPI('India')">Test with India (Should Succeed)</button>
        <button onclick="testBackendAPI('United States')">Test with US (Should Fail)</button>
        <button onclick="testBackendAPI('Canada')">Test with Canada (Should Fail)</button>
        
        <div id="backendResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Country Check Flow</h2>
        <p>Test the new country check flow before signup.</p>
        <button onclick="openCountryCheck()">Open Country Check Page</button>
        <button onclick="openWelcomePage()">Open Welcome Page</button>
    </div>

    <div class="test-section">
        <h2>Test 4: Direct Signup Form</h2>
        <p>Open the actual signup form to test the complete integration.</p>
        <button onclick="openSignupForm()">Open Signup Form</button>
    </div>

    <script>
        // Test 1: Frontend Validation
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('testName').value;
            const email = document.getElementById('testEmail').value;
            const password = document.getElementById('testPassword').value;
            const age = parseInt(document.getElementById('testAge').value);
            const country = document.getElementById('testCountry').value;
            
            const result = validateSignup(name, email, password, password, age, country, true);
            
            const resultDiv = document.getElementById('frontendResult');
            if (result) {
                resultDiv.innerHTML = '<div class="test-result success">‚úÖ Frontend validation passed - User can proceed</div>';
            } else {
                resultDiv.innerHTML = '<div class="test-result error">‚ùå Frontend validation failed - User cannot proceed</div>';
            }
        });

        function validateSignup(name, email, password, confirmPassword, age, country, agreeTerms) {
            // Name validation
            if (name.length < 2) {
                return false;
            }

            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                return false;
            }

            // Age validation
            if (!age || age < 18) {
                return false;
            }

            if (age > 120) {
                return false;
            }

            // Country validation - Only India is allowed
            if (!country || country === '') {
                return false;
            }

            if (country !== 'India') {
                return false;
            }

            // Password validation
            if (password.length < 6) {
                return false;
            }

            if (password !== confirmPassword) {
                return false;
            }

            // Terms agreement
            if (!agreeTerms) {
                return false;
            }

            return true;
        }

        // Test 2: Backend API Test
        async function testBackendAPI(country) {
            const resultDiv = document.getElementById('backendResult');
            resultDiv.innerHTML = '<div class="test-result info">üîÑ Testing backend API with country: ' + country + '</div>';
            
            try {
                const response = await fetch('http://localhost:3001/api/signup', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'testuser_' + Date.now(),
                        email: 'test_' + Date.now() + '@example.com',
                        password: 'password123',
                        age: 25,
                        country: country
                    })
                });

                const result = await response.json();
                
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="test-result success">‚úÖ Backend API accepted user from ' + country + '</div>';
                } else {
                    resultDiv.innerHTML = '<div class="test-result error">‚ùå Backend API rejected user from ' + country + ': ' + result.message + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div class="test-result error">‚ùå Backend API error: ' + error.message + '</div>';
            }
        }

        // Test 3: Open Country Check Page
        function openCountryCheck() {
            window.open('alarm-system/country-check.html', '_blank');
        }

        // Test 4: Open Welcome Page
        function openWelcomePage() {
            window.open('alarm-system/welcome.html', '_blank');
        }

        // Test 5: Open Signup Form
        function openSignupForm() {
            window.open('alarm-system/index.html', '_blank');
        }
    </script>
</body>
</html> 